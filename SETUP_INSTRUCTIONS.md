# Инструкция по настройке системы отправки PDF на email

## Что изменено

Система теперь отправляет PDF на email вместо скачивания. Внесены изменения в следующие файлы:

### 1. mocks.html
- Функция `generatePDF()` теперь конвертирует PDF в base64 и отправляет на сервер
- Добавлена функция `sendPdfToServer()` для отправки данных на Apps Script

### 2. index.html  
- Функция `generateAndDownloadPdf()` теперь отправляет PDF на сервер
- Добавлена функция `sendPdfToServer()` для отправки данных на Apps Script

## Настройка

### Шаг 1: Получите URL вашего Apps Script
1. Откройте ваш Apps Script проект
2. Нажмите "Deploy" → "New deployment"
3. Выберите тип "Web app"
4. Установите:
   - Execute as: "Me"
   - Who has access: "Anyone"
5. Нажмите "Deploy"
6. Скопируйте полученный URL

### Шаг 2: Замените URL в коде
В обоих файлах (`mocks.html` и `index.html`) замените:
```javascript
'YOUR_APPS_SCRIPT_URL_HERE'
```
на ваш реальный URL Apps Script.

### Шаг 3: Проверьте настройки Apps Script
Убедитесь, что в вашем Apps Script:
- `SPREADSHEET_ID` указан правильно
- `SHEET_NAME` установлен как "Leads"
- `DRIVE_FOLDER_ID` настроен (опционально)

## Как это работает

1. **Генерация PDF**: Пользователь проходит тест, система генерирует PDF
2. **Конвертация**: PDF конвертируется в base64 строку
3. **Отправка**: Данные отправляются на Apps Script с параметрами:
   - `action: 'email_pdf'`
   - `email`: email пользователя
   - `pdfBase64`: PDF в формате base64
   - `lang`: язык (pl/en)
   - `filename`: имя файла
4. **Обработка**: Apps Script получает PDF, отправляет на email и логирует в таблицу
5. **Подтверждение**: Пользователь получает уведомление об успешной отправке

## Тестирование

1. Откройте `mocks.html` в браузере
2. Нажмите "Generate PDF"
3. Проверьте, что PDF отправляется на указанный email
4. Проверьте логи в таблице Google Sheets

## Возможные проблемы

### CORS ошибки
Если возникают CORS ошибки, убедитесь что:
- Apps Script развернут как Web app
- Установлен правильный доступ "Anyone"

### Ошибки отправки email
Проверьте:
- Правильность email адреса
- Настройки Apps Script
- Логи в таблице Google Sheets

### Большие файлы
Если PDF слишком большой, может потребоваться:
- Уменьшить качество изображений
- Оптимизировать размер SVG
- Разбить PDF на части

## Поддержка

При возникновении проблем проверьте:
1. Консоль браузера на ошибки
2. Логи в Apps Script
3. Записи в таблице Google Sheets
